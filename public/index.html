<!DOCTYPE html>
<html>
<head>
	<title></title>
	
	<style type="text/css">

		body{
			background-color: #702632;
		}

		h1{
			text-align: center;
			color: #FFF;
		}
		
		#news {
			padding: 5px 15px;
		}

		.headline{
			font-weight: bold;
			font-family: 'Tahoma';
			color: #080705;
		}

		.blurb{
			margin-bottom: 20px;
		}

		a {
			text-decoration: none;
		}
		.commTitle{
			background-color: #000;
			color: #FFF;
			margin-top: 0;
			border: 1px solid #FFF;
			padding: 10px 10px;
			font-weight: bold;
		}
		.indivComm{
			border: 1px solid #000;
			margin-bottom: 10px;
			background-color: #40434E;
			
		}
		.commHeader{
			margin-top: 0px;
			border: 1px solid #FFF;
			padding: 6px 0px 6px 10px;
			background-color: #702632;
		}
		.userComment{
			padding: 5px 0px 0px 15px;
		}
		/*.comments {
			border: 1px solid #FFF;
			//border-radius: 2px;
			width: 65%;
			margin: 5px auto;
			height: 100px;
			background-color: #40434E;

		}*/
		.commContent{
			padding: 0px 10px;
			/*font-size: 16px;*/
			color: #FFF;
		}
		input[type=text]{
			font-size: 17px;
			background-color: #40434E;
			border-radius: 3px;
			color: #FFF;
			padding: 7px 7px;
			border: 1px solid #FFF;
			margin-left: 10px;
		}
		textarea{
			border: 1px solid #FFF;
			/*width: 65%;*/
			width: 550px;
			margin-left: 10px;
			height: 100px;
			background-color: #40434E;
			color: #FFF;
			font-size: 17px;
			border-radius: 3px;
			padding: 7px;
		}
		.nameContainer{
			/*border: 1px solid #FFF;*/
		}
		.textAreaContainer{
			/*margin: 5px 0 0 10%;*/
			border: 1px solid #000;
			/*width: 50%;*/
		}

		input[type=submit]{
			/*margin-left: 50px;*/
			float: right;
			margin-top: 50px;
			margin-right: 30%;
		}
	</style>
</head>
<body>

<h1>Associated Press News Outlet</h1>


<div id="news"></div>

<script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
<script type="text/javascript">

	var commentBox;
	var commentBoxId;
	var name;
	var objID;

	var newArticle;
	var commentsSpace;

	var date = new Date();
	var created = date.toLocaleString();

	$('body').on('click', 'input', function(){

		commentBoxId = $(this).attr('id');
		name = $('#name' + commentBoxId).val().trim();		
		commentBox = $('.'+commentBoxId).val().trim();
		objID = $(this).attr('data-id');

		$.ajax({
			type: 'POST',
			url: '/comments',
			dataType: 'json',
			data: {
				comments: commentBox,
				objID: objID,
				name: name,
				date: created

			}
		}).done(function(data){

			console.log("data is ", data);
			$('#name' + commentBoxId+'').val("");		
			$('.'+commentBoxId+'').val("");
			$('#article'+ commentBoxId + 'comments').empty();

			$.ajax({
				type: 'GET',
				url: '/showComments/' + objID
				/*dataType: 'json', 
				data: {
					objID: id
				}*/
			}).done(function(data){
				getComments(data, commentBoxId);
			});


			//getComments();

		});
	});

	function getNews(){

		//$('#news').empty();

		$.getJSON('/news', function(data){

			for(var x = 0; x < data.length; x++){

				newArticle = '<a href='+ data[x].articleURL +'><h3 class="headline">' + data[x].headline + '</h3></a><p class="link">' + data[x].articleURL + '</p><p class="blurb">' + data[x].blurb + '</p>';

				commentsSpace = '<div class="comments"><p class="commTitle">Comments</p><p class="commContent" id="article'+ x + 'comments"></p></div>';

				$('#news').append(newArticle);
				$('#news').append(commentsSpace);

				if(data[x].comments){
					getComments(data, x);					
				}


				// for(var i=0; i < data[x].comments.length; i++){

				// 	$('#article'+ x + 'comments').append("<div class='indivComm'><p class='commHeader'>" + data[x].comments[i].name + " - " + data[x].comments[i].date + "</p><p class='userComment'>" + data[x].comments[i].comment + "</p></div>");						
				// }	

				$('#news').append('<p class="nameContainer"><input type="text" id="name' + x + '" placeholder="Name"></p>');

				$('#news').append('<p class="textAreaContainer"><textarea class="' + x +'" placeholder="Comments..."></textarea><input type="submit" class="subComment" data-id="'+ data[x]._id +'" id="' + x + '" value="submit"></p>');


			}
			

		});


	}

	function getComments(data, x){
		//$.ajax(type: 'GET', url: '/showComments', {objID: id}, function(data){

		/*$.get('/showComments', {objID: id}).done(function(data){

			console.log("comments are ", data);
			console.log(data[0]);
			//console.log(""data[0].name);
			
		});*/

		// $.ajax({
		// 	type: 'GET',
		// 	url: '/showComments/' + id,
		// 	/*dataType: 'json', 
		// 	data: {
		// 		objID: id
		// 	}*/
		// }).done(function(data){

		// 	console.log("comments are ", data);
		// 	console.log(data[0]);
		// 	//console.log(""data[0].name);
			
		// });
		console.log("just data is ", data);
		console.log("data[x] is ", data[x]);

		for(var i=0; i < data[x].comments.length; i++){

			$('#article'+ x + 'comments').append("<div class='indivComm'><p class='commHeader'>" + data[x].comments[i].name + " - " + data[x].comments[i].date + "</p><p class='userComment'>" + data[x].comments[i].comment + "</p></div>");						
		}	
	}



getNews();
</script>
</body>
</html>